# Fixit Cloud ☁️ MODULE: AWS VPC

Terraform module for defining a hardened VPC and related resources.

---

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->

## Requirements

| Name                                                                     | Version  |
| ------------------------------------------------------------------------ | -------- |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | >= 1.0.0 |
| <a name="requirement_aws"></a> [aws](#requirement_aws)                   | >= 3.0.0 |

## Providers

| Name                                             | Version  |
| ------------------------------------------------ | -------- |
| <a name="provider_aws"></a> [aws](#provider_aws) | >= 3.0.0 |

## Modules

No modules.

## Resources

| Name                                                                                                                                   | Type        |
| -------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [aws_default_network_acl.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/default_network_acl)        | resource    |
| [aws_default_route_table.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/default_route_table)        | resource    |
| [aws_default_security_group.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/default_security_group)  | resource    |
| [aws_eip.NAT_GW_EIP](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eip)                                  | resource    |
| [aws_internet_gateway.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/internet_gateway)              | resource    |
| [aws_nat_gateway.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/nat_gateway)                        | resource    |
| [aws_network_acl.list](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl)                        | resource    |
| [aws_network_acl_rule.nacl_rules](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/network_acl_rule)        | resource    |
| [aws_route.internet_gateway_egress_routes](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route)          | resource    |
| [aws_route.nat_gateway_egress_routes](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route)               | resource    |
| [aws_route_table.map](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route_table)                         | resource    |
| [aws_route_table_association.map](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route_table_association) | resource    |
| [aws_security_group.map](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group)                   | resource    |
| [aws_security_group_rule.list](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule)        | resource    |
| [aws_subnet.map](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/subnet)                                   | resource    |
| [aws_vpc.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc)                                        | resource    |
| [aws_ip_ranges.cloudfront](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ip_ranges)                   | data source |
| [aws_ip_ranges.ec2_instance_connect](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ip_ranges)         | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region)                            | data source |

## Inputs

| Name                                                                                                | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Default                                                                                                                | Required |
| --------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------- | :------: |
| <a name="input_default_resource_tags"></a> [default_resource_tags](#input_default_resource_tags)    | In accordance with best practices, this module locks down the VPC's default<br>components to ensure all ingress/egress traffic only uses infrastructure with<br>purposefully-designed rules and configs. Default subnets must be deleted manually<br>- they cannot be removed via Terraform. This variable allows you to customize the<br>tags on these "default" network components.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | <pre>object({<br> default_route_table = optional(map(string))<br> default_network_acl = optional(map(string))<br> default_security_group = optional(map(string))<br> })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | <pre>{<br> "default_network_acl": null,<br> "default_route_table": null,<br> "default_security_group": null<br>}</pre> |    no    |
| <a name="input_gateway_tags"></a> [gateway_tags](#input_gateway_tags)                               | Config object for VPC gateway resource tags.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | <pre>object({<br> internet_gateway = optional(map(string))<br> nat_gateway = optional(map(string))<br> nat_gateway_elastic_ip = optional(map(string))<br> })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | n/a                                                                                                                    |   yes    |
| <a name="input_network_acl_configs"></a> [network_acl_configs](#input_network_acl_configs)          | List of config objects for Network ACL resources. For ingress/egress rule config objects,<br>instead of providing separate "from_port" and "to_port" args, you can alternatively provide<br>just "port" which will map to both. You can also pass a string value like "HTTPS" or "Redis"<br>(case-insensitive) to the "default_port" arg to have the default port of the protocol/service<br>mapped to both. Refer to the README for a list of supported arguments for "default_port". If<br>you need the cidr_block of a particular AWS service, like EC2 Instance Connect, you can pass<br>cidr_block = "EC2_INSTANCE_CONNECT". Please refer to the README to for a list of supported<br>AWS services for "cidr_block".                                                                                                                                                                                                                                                                                                                                                                           | <pre>list(object({<br> subnet_cidrs = list(string)<br> access = optional(object({<br> ingress = optional(list(object({<br> rule_number = number<br> cidr_block = string<br> protocol = optional(string)<br> default_port = optional(string)<br> port = optional(number)<br> from_port = optional(number)<br> to_port = optional(number)<br> })))<br> egress = optional(list(object({<br> rule_number = number<br> cidr_block = string<br> protocol = optional(string)<br> default_port = optional(string)<br> port = optional(number)<br> from_port = optional(number)<br> to_port = optional(number)<br> })))<br> }))<br> tags = optional(map(string))<br> }))</pre>                                                                                                                                                                                                                                                                                                                                                          | n/a                                                                                                                    |   yes    |
| <a name="input_route_table_tags"></a> [route_table_tags](#input_route_table_tags)                   | Map of route table resource tags, with subnet egress destinations as keys<br>(see the description for "var.subnets" for more info). The keys must either<br>be "INTERNET_GATEWAY", "NAT_GATEWAY", or a valid CIDR block quoted string<br>pointing to another VPC. Support for other destination types, such as<br>"VIRTUAL_PRIVATE_GATEWAY", will be added in the future.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `map(map(string))`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | <pre>{<br> "INTERNET_GATEWAY": {},<br> "NAT_GATEWAY": {}<br>}</pre>                                                    |    no    |
| <a name="input_security_group_configs"></a> [security_group_configs](#input_security_group_configs) | List of config objects for security group resources. For ingress/egress rule config objects,<br>instead of providing separate "from_port" and "to_port" args, you can alternatively provide<br>just "port" which will map to both. You can also pass a string value like "HTTPS" or "Redis"<br>(case-insensitive) to the "default_port" arg to have the default port of the protocol/service<br>mapped to both. Refer to the README for a list of supported arguments for "default_port". If<br>you need the cidr_blocks of a particular AWS service, like EC2 Instance Connect, you can pass<br>aws_service = "EC2_INSTANCE_CONNECT". Please refer to the README to for a list of supported<br>arguments for "aws_service".                                                                                                                                                                                                                                                                                                                                                                        | <pre>list(object({<br> name = string<br> description = string<br> access = optional(object({<br> ingress = optional(list(object({<br> description = string<br> protocol = optional(string)<br> default_port = optional(string)<br> port = optional(number)<br> from_port = optional(number)<br> to_port = optional(number)<br> peer_security_group_id = optional(string)<br> peer_security_group = optional(string)<br> aws_service = optional(string)<br> cidr_blocks = optional(list(string))<br> self = optional(bool)<br> })))<br> egress = optional(list(object({<br> description = string<br> protocol = optional(string)<br> default_port = optional(string)<br> port = optional(number)<br> from_port = optional(number)<br> to_port = optional(number)<br> peer_security_group_id = optional(string)<br> peer_security_group = optional(string)<br> aws_service = optional(string)<br> cidr_blocks = optional(list(string))<br> self = optional(bool)<br> })))<br> }))<br> tags = optional(map(string))<br> }))</pre> | n/a                                                                                                                    |   yes    |
| <a name="input_subnets"></a> [subnets](#input_subnets)                                              | Map of subnet config objects with quoted CIDR strings as keys (e.g., "127.1.0.0/24").<br>All CIDR blocks must fit within the given VPC, and must not overlap with one another.<br>The "egress_destination" property can be "INTERNET_GATEWAY", "NAT_GATEWAY", a valid<br>CIDR block string pointing to another VPC, or "NONE". Support for other destination<br>types, such as "VIRTUAL_PRIVATE_GATEWAY", will be added in the future. If set to "NONE",<br>egress traffic will not be able to leave the subnet. Aside from determining which route<br>table each subnet is associated with, the values of this property across all subnets<br>collectively determine which gateways and route tables get created within the VPC.<br>The property "contains_nat_gateway" is optional (with a default value of "false"), and<br>determines in which subnet - if any - the NAT gateway should be placed. Only one subnet<br>can have this property set to "true"; if no subnets have "contains_nat_gateway" set to<br>"true", the NAT gateway and its associated elastic IP address shall be skipped. | <pre>map(object({<br> availability_zone = string<br> egress_destination = string<br> contains_nat_gateway = optional(bool)<br> tags = optional(map(string))<br> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | n/a                                                                                                                    |   yes    |
| <a name="input_vpc"></a> [vpc](#input_vpc)                                                          | Config object for the VPC; all optional bools default to "true".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | <pre>object({<br> cidr_block = string<br> enable_dns_support = optional(bool)<br> enable_dns_hostnames = optional(bool)<br> tags = optional(map(string))<br> })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | n/a                                                                                                                    |   yes    |

## Outputs

| Name                                                                                               | Description                                                                                                                                                             |
| -------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <a name="output_Default_NetworkACL"></a> [Default_NetworkACL](#output_Default_NetworkACL)          | The VPC's default network ACL resource object.                                                                                                                          |
| <a name="output_Default_RouteTable"></a> [Default_RouteTable](#output_Default_RouteTable)          | The VPC's default route table resource object.                                                                                                                          |
| <a name="output_Default_SecurityGroup"></a> [Default_SecurityGroup](#output_Default_SecurityGroup) | The VPC's default security group resource object.                                                                                                                       |
| <a name="output_Internet_GW"></a> [Internet_GW](#output_Internet_GW)                               | The internet gateway resource object.                                                                                                                                   |
| <a name="output_NAT_GW"></a> [NAT_GW](#output_NAT_GW)                                              | The NAT gateway resource object.                                                                                                                                        |
| <a name="output_NAT_GW_EIP"></a> [NAT_GW_EIP](#output_NAT_GW_EIP)                                  | The NAT gateway's elastic IP address resource object.                                                                                                                   |
| <a name="output_Network_ACLs"></a> [Network_ACLs](#output_Network_ACLs)                            | A list of network ACL resource objects with their respective RULES merged in.                                                                                           |
| <a name="output_RouteTables"></a> [RouteTables](#output_RouteTables)                               | Map of route table resource objects, with "egress_destination" values as keys.                                                                                          |
| <a name="output_Security_Groups"></a> [Security_Groups](#output_Security_Groups)                   | A map of security group resource objects with their respective RULES merged in.                                                                                         |
| <a name="output_Subnets"></a> [Subnets](#output_Subnets)                                           | Map of subnet resource objects, with CIDR blocks as keys. User-provided values<br>"egress_destination" and "contains_nat_gateway" are merged into the resource objects. |
| <a name="output_VPC"></a> [VPC](#output_VPC)                                                       | The VPC resource object.                                                                                                                                                |

<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->

---

## License

All scripts and source code contained herein are for commercial use only by Nerdware, LLC.

See [LICENSE](/LICENSE) for more information.

## Contact

Trevor Anderson - [@TeeRevTweets](https://twitter.com/teerevtweets) - T.AndersonProperty@gmail.com

[![LinkedIn][linkedin-shield]][linkedin-url]

<!-- MARKDOWN LINKS & IMAGES -->
<!-- https://www.markdownguide.org/basic-syntax/#reference-style-links -->

[pre-commit-shield]: https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit&logoColor=white
[fixit-cloud-live]: https://github.com/Nerdware-LLC/fixit-cloud-live
[pets-meme]: https://cloudscaling.com/blog/cloud-computing/the-history-of-pets-vs-cattle/
[linkedin-url]: https://www.linkedin.com/in/trevor-anderson-3a3b0392/
[linkedin-shield]: https://img.shields.io/badge/LinkedIn-0077B5?logo=linkedin&logoColor=white
